<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng quay lÃ¬ xÃ¬ ðŸ§§</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: radial-gradient(circle, #ffcc00, #cc0000);
        text-align: center;
        color: #fff;
        padding-top: 20px;
    }

    canvas {
        background: #fff;
        border-radius: 50%;
        margin-top: 20px;
    }

    button {
        margin-top: 20px;
        padding: 14px 30px;
        font-size: 18px;
        border: none;
        border-radius: 30px;
        background: gold;
        font-weight: bold;
        cursor: pointer;
    }

    #result {
        margin-top: 20px;
        font-size: 26px;
        font-weight: bold;
    }

    .arrow {
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-bottom: 30px solid red;
        margin: auto;
    }
</style>
</head>
<body>

<h1>ðŸ§§ QUAY LÃŒ XÃŒ Táº¾T ðŸ§§</h1>
<h2 id="username"></h2>
<div class="arrow"></div>
<canvas id="wheel" width="400" height="400"></canvas>

<br>
<button onclick="spin()">QUAY LÃŒ XÃŒ ðŸŽ‰</button>

<div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const name = localStorage.getItem("lixi_name");

if (name) {
    document.getElementById("username").innerText =
        "ðŸŽŠ LÃ¬ xÃ¬ cho: " + name;
}


const items = [
    "10.000Ä‘",
    "20.000Ä‘",
    "50.000Ä‘",
    "100.000Ä‘",
    "200.000Ä‘",
    "500.000Ä‘",
    "âŒ Máº¤T LÆ¯á»¢T"
];

const weights = [
    23,
    40, 
    15,
    7,
    0, 
    0, 
    15 
];

const trollMessages = {
    "10.000Ä‘": [
        "ðŸ’¸ {name} Æ¡i, tiá»n Ã­t nhÆ°ng lá»™c nhiá»u nha ðŸ˜„",
        "ðŸ˜Œ {name} má»Ÿ hÃ ng nháº¹ nhÃ ng cho vui!",
        "ðŸ¤ {name} Ã , Ã­t nhÆ°ng lÃ  lá»™c Ä‘Ã³!"
    ],
    "20.000Ä‘": [
        "ðŸ™‚ {name} Ä‘á»§ tiá»n mua trÃ  sá»¯a rá»“i Ä‘Ã³!",
        "ðŸ˜Ž NhÃ¢n pháº©m cá»§a {name} cÅ©ng á»•n Ã¡p nha!",
        "âœ¨ Lá»™c nhá» nhÆ°ng hÃªn to nha {name}!"
    ],
    "50.000Ä‘": [
        "ðŸ˜ {name} hÃ´m nay hÃªn Ä‘Ã³!",
        "ðŸ”¥ NhÃ¢n pháº©m cá»§a {name} Ä‘ang lÃªn!",
        "ðŸ’° {name} báº¯t Ä‘áº§u tháº¥y mÃ¹i tiá»n rá»“i!"
    ],
    "100.000Ä‘": [
        "ðŸ˜³ {name} Æ¡i, cÅ©ng dá»¯ Ä‘Ã³!",
        "ðŸŽ‰ NhÃ¢n pháº©m {name} lÃªn level rá»“i!",
        "ðŸ”¥ {name} cháº¯c sá»‘ng tá»‘t láº¯m!"
    ],
    "200.000Ä‘": [
        "ðŸ˜± {name} Æ¡i, cÃ¡i nÃ y lÃ  BUG!",
        "ðŸš¨ Há»‡ thá»‘ng khÃ´ng tin ná»•i {name}!",
        "âŒ {name} Ä‘Ã¡ng láº½ khÃ´ng Ä‘Æ°á»£c trÃºng!"
    ],
    "500.000Ä‘": [
        "ðŸ’€ {name} lÃ m sáº­p há»‡ thá»‘ng!",
        "ðŸ”¥ Chá»§ lÃ¬ xÃ¬ bá» cháº¡y vÃ¬ {name}!",
        "ðŸš¨ Lá»—i nghiÃªm trá»ng do {name}!"
    ],
    "âŒ Máº¤T LÆ¯á»¢T": [
        "ðŸ¤£ {name} quay cho vui thÃ´i chá»© ai cho trÃºng!",
        "ðŸ’€ {name} há»‡ thá»‘ng khÃ´ng thÃ­ch báº¡n!",
        "ðŸ˜† {name} tá»›i lÃ  tháº¥y thiáº¿u tiá»n liá»n!"
    ]
};



let angle = 0;
let spinning = false;

function drawWheel() {
    const center = 200;
    const radius = 200;
    const slice = 2 * Math.PI / items.length;

    ctx.clearRect(0, 0, 400, 400);

    items.forEach((item, i) => {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, angle + i * slice, angle + (i + 1) * slice);
        ctx.fillStyle = `hsl(${i * 360 / items.length}, 80%, 55%)`;
        ctx.fill();
        ctx.stroke();

        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(angle + (i + 0.5) * slice);
        ctx.fillStyle = "#000";
        ctx.font = "bold 18px Arial";
        ctx.textAlign = "right";
        ctx.fillText(item, radius - 15, 8);
        ctx.restore();
    });
}

function spin() {
    if (spinning) return;
    spinning = true;

    const targetIndex = getWeightedIndex(weights);
    const slice = 2 * Math.PI / items.length;


    const targetAngle =
        (3 * Math.PI / 2) - (targetIndex + 0.5) * slice;

   
    const rounds = Math.floor(Math.random() * 3) + 4;
    const startAngle = angle;
    const endAngle = rounds * 2 * Math.PI + targetAngle;

    let start = null;
    const duration = 4000;

    function animate(timestamp) {
        if (!start) start = timestamp;
        const progress = Math.min((timestamp - start) / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);

        angle = startAngle + (endAngle - startAngle) * easeOut;
        drawWheel();

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            angle = endAngle;
            spinning = false;
            showResultByIndex(targetIndex);
        }
    }

    requestAnimationFrame(animate);
}


function getWeightedIndex(weights) {
    const total = weights.reduce((a, b) => a + b, 0);
    let rand = Math.random() * total;

    for (let i = 0; i < weights.length; i++) {
        if (rand < weights[i]) {
            return i;
        }
        rand -= weights[i];
    }
    return 0;
}
function getRandomTroll(item, name) {
    const list = trollMessages[item];
    if (!list || list.length === 0) return "";
    const msg = list[Math.floor(Math.random() * list.length)];
    return msg.replaceAll("{name}", name || "Báº¡n");
}



function showResultByIndex(index) {
    const displayName = name ? name : "Báº¡n";
    const item = items[index];
    const troll = getRandomTroll(item, displayName);

    if (item === "âŒ Máº¤T LÆ¯á»¢T") {
        document.getElementById("result").innerText =
            `ðŸ˜† ${displayName} bá»‹ Máº¤T LÆ¯á»¢T!\n${troll}`;
    } else {
        document.getElementById("result").innerText =
            `ðŸ§§ ${displayName} nháº­n Ä‘Æ°á»£c: ${item}\n${troll}`;
    }
}



drawWheel();
</script>

</body>
</html>
