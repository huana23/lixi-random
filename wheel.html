<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V√≤ng quay l√¨ x√¨ üßß</title>

<style>
* {
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background: radial-gradient(circle, #ffcc00, #cc0000);
    text-align: center;
    color: #fff;
    margin: 0;
    padding: 20px 10px 40px;
}

/* ===== TI√äU ƒê·ªÄ ===== */
h1 {
    font-size: 24px;
    margin-bottom: 5px;
}

h2 {
    font-size: 18px;
    margin-top: 0;
    opacity: 0.95;
}

/* ===== CONTAINER ===== */
.wheel-container {
    position: relative;
    width: 90vw;
    max-width: 400px;
    margin: 20px auto 10px;
}

/* ===== CANVAS ===== */
canvas {
    width: 100%;
    height: auto;
    background: #fff;
    border-radius: 50%;
}

/* ===== M≈®I T√äN ===== */
.arrow {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 38px;
    background: red;
    border-radius: 4px;
    z-index: 10;
}

.arrow::after {
    content: "";
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 14px solid red;
}

@keyframes arrowShake {
    0% { transform: translateX(-50%) rotate(0deg); }
    25% { transform: translateX(-50%) rotate(6deg); }
    50% { transform: translateX(-50%) rotate(-6deg); }
    100% { transform: translateX(-50%) rotate(0deg); }
}

/* ===== BUTTON ===== */
button {
    margin-top: 20px;
    padding: 14px 28px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: gold;
    font-weight: bold;
    cursor: pointer;
    width: 90%;
    max-width: 280px;
}

button:active {
    transform: scale(0.97);
}

/* ===== RESULT ===== */
#result {
    margin-top: 18px;
    font-size: 20px;
    font-weight: bold;
    white-space: pre-line;
}

/* üì± MOBILE NH·ªé */
@media (max-width: 360px) {
    h1 { font-size: 20px; }
    h2 { font-size: 16px; }
    #result { font-size: 18px; }
}
</style>
</head>

<body>

<h1>üßß QUAY L√å X√å T·∫æT üßß</h1>
<h2 id="username"></h2>

<div class="wheel-container">
    <div class="arrow"></div>
    <canvas id="wheel" width="400" height="400"></canvas>
</div>

<button onclick="spin()">QUAY L√å X√å üéâ</button>

<div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const arrow = document.querySelector(".arrow");

const name = localStorage.getItem("lixi_name") || "B·∫°n";
document.getElementById("username").innerText = "üéä L√¨ x√¨ cho: " + name;

const items = [
    "10.000ƒë",
    "20.000ƒë",
    "50.000ƒë",
    "100.000ƒë",
    "200.000ƒë",
    "500.000ƒë",
    "‚ùå M·∫§T L∆Ø·ª¢T"
];

const weights = [23, 40, 15, 7, 0, 0, 15];

const trollMessages = {
    "10.000ƒë": [
        "üí∏ {name} m·ªü h√†ng cho vui nha!",
        "ü§è {name} √≠t nh∆∞ng l√† l·ªôc!",
        "üòå {name} nh·∫π nh√†ng ƒë·∫ßu nƒÉm!"
    ],
    "20.000ƒë": [
        "üôÇ {name} ƒë·ªß ti·ªÅn tr√† s·ªØa r·ªìi!",
        "üòé Nh√¢n ph·∫©m {name} ·ªïn √°p!",
        "‚ú® L·ªôc nh·ªè nh∆∞ng vui nha {name}!"
    ],
    "50.000ƒë": [
        "üòè {name} h√¥m nay c√≥ s·ªë!",
        "üî• Nh√¢n ph·∫©m {name} ƒëang l√™n!",
        "üí∞ {name} th·∫•y m√πi ti·ªÅn r·ªìi!"
    ],
    "100.000ƒë": [
        "üò≥ {name} s·ªëng t·ªët d·ªØ ha!",
        "üéâ {name} nh√¢n ph·∫©m cao!",
        "üî• Ch·ªß l√¨ x√¨ h∆°i run!"
    ],
    "‚ùå M·∫§T L∆Ø·ª¢T": [
        "ü§£ {name} quay cho vui th√¥i!",
        "üíÄ {name} b·ªã h·ªá th·ªëng gh√©t!",
        "üòÜ {name} h·∫πn nƒÉm sau nha!"
    ]
};

let angle = 0;
let spinning = false;

function drawWheel() {
    const center = 200;
    const radius = 200;
    const slice = 2 * Math.PI / items.length;

    ctx.clearRect(0, 0, 400, 400);

    items.forEach((item, i) => {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, angle + i * slice, angle + (i + 1) * slice);
        ctx.fillStyle = `hsl(${i * 360 / items.length}, 80%, 55%)`;
        ctx.fill();
        ctx.stroke();

        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(angle + (i + 0.5) * slice);
        ctx.fillStyle = "#000";
        ctx.font = "bold 18px Arial";
        ctx.textAlign = "right";
        ctx.fillText(item, radius - 15, 8);
        ctx.restore();
    });
}

function spin() {
    if (spinning) return;
    spinning = true;
    result.innerText = "";

    const targetIndex = getWeightedIndex(weights);
    const slice = 2 * Math.PI / items.length;
    const targetAngle = (3 * Math.PI / 2) - (targetIndex + 0.5) * slice;
    const rounds = Math.floor(Math.random() * 3) + 4;

    const startAngle = angle;
    const endAngle = rounds * 2 * Math.PI + targetAngle;

    let start = null;
    const duration = 4000;

    function animate(t) {
        if (!start) start = t;
        const progress = Math.min((t - start) / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);

        angle = startAngle + (endAngle - startAngle) * ease;
        drawWheel();

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            angle = endAngle;
            spinning = false;
            arrow.style.animation = "arrowShake 0.4s";
            setTimeout(() => arrow.style.animation = "", 400);
            showResult(targetIndex);
        }
    }
    requestAnimationFrame(animate);
}

function getWeightedIndex(weights) {
    const total = weights.reduce((a, b) => a + b, 0);
    let rand = Math.random() * total;
    for (let i = 0; i < weights.length; i++) {
        if (rand < weights[i]) return i;
        rand -= weights[i];
    }
    return 0;
}

function getRandomTroll(item) {
    const list = trollMessages[item];
    if (!list) return "";
    return list[Math.floor(Math.random() * list.length)].replaceAll("{name}", name);
}

function showResult(index) {
    const item = items[index];
    const troll = getRandomTroll(item);
    result.innerText = item === "‚ùå M·∫§T L∆Ø·ª¢T"
        ? `üòÜ ${name} b·ªã M·∫§T L∆Ø·ª¢T!\n${troll}`
        : `üßß ${name} nh·∫≠n ƒë∆∞·ª£c: ${item}\n${troll}`;
}

drawWheel();
</script>

</body>
</html>
