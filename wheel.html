<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>VÃ²ng quay lÃ¬ xÃ¬ ðŸ§§</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: radial-gradient(circle, #ffcc00, #cc0000);
    text-align: center;
    color: #fff;
    padding-top: 20px;
}

.wheel-container {
    position: relative;
    width: 400px;
    margin: auto;
    padding-top: 30px;
}

canvas {
    background: #fff;
    border-radius: 50%;
}

/* ===== MÅ¨I TÃŠN ===== */
.arrow {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 40px;
    background: red;
    border-radius: 4px;
    z-index: 10;
}

.arrow::after {
    content: "";
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-top: 14px solid red;
}

@keyframes arrowShake {
    0% { transform: translateX(-50%) rotate(0deg); }
    25% { transform: translateX(-50%) rotate(5deg); }
    50% { transform: translateX(-50%) rotate(-5deg); }
    100% { transform: translateX(-50%) rotate(0deg); }
}

button {
    margin-top: 20px;
    padding: 14px 30px;
    font-size: 18px;
    border: none;
    border-radius: 30px;
    background: gold;
    font-weight: bold;
    cursor: pointer;
}

#result {
    margin-top: 20px;
    font-size: 24px;
    font-weight: bold;
    white-space: pre-line;
}

</style>
</head>

<body>

<h1>ðŸ§§ QUAY LÃŒ XÃŒ Táº¾T ðŸ§§</h1>
<h2 class="title" id="username"></h2>

<div class="wheel-container">
    <div class="arrow"></div>
    <canvas id="wheel" width="400" height="400"></canvas>
</div>

<button onclick="spin()">QUAY LÃŒ XÃŒ ðŸŽ‰</button>

<div id="result"></div>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const arrow = document.querySelector(".arrow");

const name = localStorage.getItem("lixi_name") || "Báº¡n";
document.getElementById("username").innerText = "ðŸŽŠ LÃ¬ xÃ¬ cho: " + name;

const items = [
    "10.000Ä‘",
    "20.000Ä‘",
    "50.000Ä‘",
    "100.000Ä‘",
    "200.000Ä‘",
    "500.000Ä‘",
    "âŒ Máº¤T LÆ¯á»¢T"
];

const weights = [
    23, // 10k
    40, // 20k
    15, // 50k
    7,  // 100k
    0,  // 200k khÃ³a
    0,  // 500k khÃ³a
    15  // máº¥t lÆ°á»£t
];

const trollMessages = {
    "10.000Ä‘": [
        "ðŸ’¸ {name} má»Ÿ hÃ ng cho vui nha!",
        "ðŸ¤ {name} Ã­t nhÆ°ng lÃ  lá»™c!",
        "ðŸ˜Œ {name} nháº¹ nhÃ ng Ä‘áº§u nÄƒm!"
    ],
    "20.000Ä‘": [
        "ðŸ™‚ {name} Ä‘á»§ tiá»n trÃ  sá»¯a rá»“i!",
        "ðŸ˜Ž NhÃ¢n pháº©m {name} á»•n Ã¡p!",
        "âœ¨ Lá»™c nhá» nhÆ°ng vui nha {name}!"
    ],
    "50.000Ä‘": [
        "ðŸ˜ {name} hÃ´m nay cÃ³ sá»‘!",
        "ðŸ”¥ NhÃ¢n pháº©m {name} Ä‘ang lÃªn!",
        "ðŸ’° {name} tháº¥y mÃ¹i tiá»n rá»“i!"
    ],
    "100.000Ä‘": [
        "ðŸ˜³ {name} sá»‘ng tá»‘t dá»¯ ha!",
        "ðŸŽ‰ {name} nhÃ¢n pháº©m cao!",
        "ðŸ”¥ Chá»§ lÃ¬ xÃ¬ hÆ¡i run!"
    ],
    "âŒ Máº¤T LÆ¯á»¢T": [
        "ðŸ¤£ {name} quay cho vui thÃ´i!",
        "ðŸ’€ {name} bá»‹ há»‡ thá»‘ng ghÃ©t!",
        "ðŸ˜† {name} háº¹n nÄƒm sau nha!"
    ]
};

let angle = 0;
let spinning = false;

/* ===== Váº¼ VÃ’NG ===== */
function drawWheel() {
    const center = 200;
    const radius = 200;
    const slice = 2 * Math.PI / items.length;

    ctx.clearRect(0, 0, 400, 400);

    items.forEach((item, i) => {
        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, angle + i * slice, angle + (i + 1) * slice);
        ctx.fillStyle = `hsl(${i * 360 / items.length}, 80%, 55%)`;
        ctx.fill();
        ctx.stroke();

        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(angle + (i + 0.5) * slice);
        ctx.fillStyle = "#000";
        ctx.font = "bold 18px Arial";
        ctx.textAlign = "right";
        ctx.fillText(item, radius - 15, 8);
        ctx.restore();
    });
}

/* ===== QUAY ===== */
function spin() {
    if (spinning) return;
    spinning = true;
    document.getElementById("result").innerText = "";

    const targetIndex = getWeightedIndex(weights);
    const slice = 2 * Math.PI / items.length;

    const targetAngle = (3 * Math.PI / 2) - (targetIndex + 0.5) * slice;
    const rounds = Math.floor(Math.random() * 3) + 4;

    const startAngle = angle;
    const endAngle = rounds * 2 * Math.PI + targetAngle;

    let start = null;
    const duration = 4000;

    function animate(t) {
        if (!start) start = t;
        const progress = Math.min((t - start) / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);

        angle = startAngle + (endAngle - startAngle) * ease;
        drawWheel();

        if (progress < 1) {
            requestAnimationFrame(animate);
        } else {
            angle = endAngle;
            spinning = false;
            arrow.style.animation = "arrowShake 0.4s";
            setTimeout(() => arrow.style.animation = "", 400);
            showResult(targetIndex);
        }
    }
    requestAnimationFrame(animate);
}

function getWeightedIndex(weights) {
    const total = weights.reduce((a, b) => a + b, 0);
    let rand = Math.random() * total;

    for (let i = 0; i < weights.length; i++) {
        if (rand < weights[i]) return i;
        rand -= weights[i];
    }
    return 0;
}

function getRandomTroll(item) {
    const list = trollMessages[item];
    if (!list) return "";
    return list[Math.floor(Math.random() * list.length)].replaceAll("{name}", name);
}

function showResult(index) {
    const item = items[index];
    const troll = getRandomTroll(item);

    if (item === "âŒ Máº¤T LÆ¯á»¢T") {
        result.innerText = `ðŸ˜† ${name} bá»‹ Máº¤T LÆ¯á»¢T!\n${troll}`;
    } else {
        result.innerText = `ðŸ§§ ${name} nháº­n Ä‘Æ°á»£c: ${item}\n${troll}`;
    }
}

drawWheel();
</script>

</body>
</html>
